package me.fluffycq.icehack.module.modules.exploit;

import me.fluffycq.icehack.module.Category;
import me.fluffycq.icehack.module.Module;
import net.minecraft.entity.Entity;
import net.minecraft.network.play.client.CPacketVehicleMove;

public class Vanish extends Module {

    Entity riding;

    public Vanish() {
        super("Vanish", 0, Category.EXPLOITS);
    }

    public void onEnable() {
        if (Vanish.mc.player.getRidingEntity() != null) {
            Vanish.mc.renderGlobal.loadRenderers();
            this.riding = Vanish.mc.player.getRidingEntity();
            Vanish.mc.player.dismountRidingEntity();
            Vanish.mc.world.removeEntity(this.riding);
        } else {
            this.disable();
        }

    }

    public void onDisable() {
        if (this.riding != null) {
            this.riding.isDead = false;
            Vanish.mc.world.loadedEntityList.add(this.riding);
            Vanish.mc.player.startRiding(this.riding, true);
            this.riding = null;
        }

    }

    public void onUpdate() {
        if (Vanish.mc.player.getRidingEntity() != null) {
            this.riding = null;
        }

        if (this.riding == null && Vanish.mc.player.getRidingEntity() != null) {
            this.riding = Vanish.mc.player.getRidingEntity();
            Vanish.mc.player.dismountRidingEntity();
            Vanish.mc.world.removeEntity(this.riding);
        }

        if (this.riding != null) {
            this.riding.setPosition(Vanish.mc.player.posX, Vanish.mc.player.posY, Vanish.mc.player.posZ);
            Vanish.mc.player.connection.sendPacket(new CPacketVehicleMove(this.riding));
        }

    }
}
